<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Watermark Remover (Masking Tool)</title>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-10 font-sans">

    <div class="max-w-2xl mx-auto bg-white p-8 rounded shadow-lg">
        <h1 class="text-2xl font-bold mb-4 text-gray-800">PDF Watermark Hider</h1>
        <p class="text-gray-600 mb-6">Since this runs in your browser, your files remain private. This tool draws a white box over the watermark.</p>

        <div class="mb-6">
            <label class="block mb-2 font-bold">1. Select PDF</label>
            <input type="file" id="pdfInput" accept="application/pdf" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100"/>
        </div>

        <div class="mb-6 grid grid-cols-2 gap-4">
            <div class="col-span-2">
                <label class="block mb-2 font-bold">2. Set Mask Area (coordinates)</label>
                <p class="text-xs text-gray-500 mb-2">Adjust these to cover the watermark completely.</p>
            </div>
            
            <div>
                <label class="block text-sm">X Position (from left)</label>
                <input type="number" id="xCoord" value="50" class="border p-2 w-full rounded">
            </div>
            <div>
                <label class="block text-sm">Y Position (from bottom)</label>
                <input type="number" id="yCoord" value="50" class="border p-2 w-full rounded">
            </div>
            <div>
                <label class="block text-sm">Width</label>
                <input type="number" id="width" value="200" class="border p-2 w-full rounded">
            </div>
            <div>
                <label class="block text-sm">Height</label>
                <input type="number" id="height" value="50" class="border p-2 w-full rounded">
            </div>
        </div>

        <button onclick="removeWatermark()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition w-full font-bold">
            Remove Watermark & Download
        </button>
        
        <p id="status" class="mt-4 text-center text-sm text-gray-500"></p>
    </div>

    <script>
        async function removeWatermark() {
            const fileInput = document.getElementById('pdfInput');
            const status = document.getElementById('status');
            
            if (fileInput.files.length === 0) {
                alert("Please select a file first!");
                return;
            }

            try {
                status.innerText = "Processing...";
                
                // 1. Load the PDF
                const file = fileInput.files[0];
                const arrayBuffer = await file.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                
                // 2. Get user coordinates
                const x = Number(document.getElementById('xCoord').value);
                const y = Number(document.getElementById('yCoord').value);
                const w = Number(document.getElementById('width').value);
                const h = Number(document.getElementById('height').value);

                // 3. Iterate through all pages
                const pages = pdfDoc.getPages();
                pages.forEach(page => {
                    // Draw a white rectangle over the watermark area
                    page.drawRectangle({
                        x: x,
                        y: y,
                        width: w,
                        height: h,
                        color: PDFLib.rgb(1, 1, 1), // White color
                        opacity: 1,
                    });
                });

                // 4. Save and Download
                const pdfBytes = await pdfDoc.save();
                download(pdfBytes, "clean_" + file.name);
                status.innerText = "Done! Downloading...";

            } catch (err) {
                console.error(err);
                status.innerText = "Error processing PDF.";
                alert("An error occurred. Check the console for details.");
            }
        }

        function download(data, filename) {
            const blob = new Blob([data], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
